// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

model User {
  id                   String   @id @default(cuid())
  email                String   @unique
  name                 String
  skill_level          String   // enum: beginner, intermediate, advanced
  programming_experience String?
  hardware_availability String?
  created_at           DateTime @default(now())
  updated_at           DateTime @updatedAt

  // Relations
  progress             Progress[]
}

model Chapter {
  id          String   @id @default(cuid())
  title       String
  slug        String   @unique
  week_number Int?
  content     String
  order       Int
  created_at  DateTime @default(now())
  updated_at  DateTime @updatedAt

  // Relations
  topics      Topic[]
  progress    Progress[]
}

model Topic {
  id          String   @id @default(cuid())
  title       String
  content     String
  order       Int
  chapter_id  String   @db.VarChar(25) // Foreign key to Chapter
  created_at  DateTime @default(now())
  updated_at  DateTime @updatedAt

  // Relations
  chapter     Chapter @relation(fields: [chapter_id], references: [id], onDelete: Cascade)
  code_examples CodeExample[]
}

model CodeExample {
  id          String   @id @default(cuid())
  title       String
  code        String
  language    String   // enum: python, urdf, launch_xml
  description String?
  order       Int
  topic_id    String   @db.VarChar(25) // Foreign key to Topic
  created_at  DateTime @default(now())
  updated_at  DateTime @updatedAt

  // Relations
  topic       Topic @relation(fields: [topic_id], references: [id], onDelete: Cascade)
}

model LabExercise {
  id          String   @id @default(cuid())
  week_number Int
  title       String
  content     String
  difficulty  String?  // enum: beginner, intermediate, advanced
  estimated_time Int?  // time in minutes
  created_at  DateTime @default(now())
  updated_at  DateTime @updatedAt
}

model Quiz {
  id          String   @id @default(cuid())
  module_id   String   // which module/chapter this quiz belongs to
  title       String
  created_at  DateTime @default(now())
  updated_at  DateTime @updatedAt

  // Relations
  questions   QuizQuestion[]
}

model QuizQuestion {
  id          String   @id @default(cuid())
  quiz_id     String   @db.VarChar(25) // Foreign key to Quiz
  question_text String
  question_type String // enum: multiple_choice, true_false, short_answer
  order       Int
  created_at  DateTime @default(now())
  updated_at  DateTime @updatedAt

  // Relations
  quiz        Quiz @relation(fields: [quiz_id], references: [id], onDelete: Cascade)
  answers     QuizAnswer[]
}

model QuizAnswer {
  id          String   @id @default(cuid())
  question_id String   @db.VarChar(25) // Foreign key to QuizQuestion
  answer_text String
  is_correct  Boolean
  explanation String?
  order       Int
  created_at  DateTime @default(now())
  updated_at  DateTime @updatedAt

  // Relations
  question    QuizQuestion @relation(fields: [question_id], references: [id], onDelete: Cascade)
}

model Progress {
  id                String   @id @default(cuid())
  user_id           String   @db.VarChar(25) // Foreign key to User
  chapter_id        String   @db.VarChar(25) // Foreign key to Chapter
  completed         Boolean  @default(false)
  progressPercentage Float    @default(0)
  currentSection    String?
  quiz_score        Float?
  completed_at      DateTime?
  created_at        DateTime @default(now())
  updated_at        DateTime @updatedAt

  // Relations
  user        User @relation(fields: [user_id], references: [id], onDelete: Cascade)
  chapter     Chapter @relation(fields: [chapter_id], references: [id], onDelete: Cascade)

  @@unique([user_id, chapter_id])
}